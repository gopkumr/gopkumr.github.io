<!doctype html><html lang=en-au>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width">
<script type=application/javascript src=https://www.beneathabstraction.com/js/theme-mode.js></script>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/frameworks.min.css>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/github.min.css>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/github-style.css>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/light.css>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/dark.css>
<link rel=stylesheet href=https://www.beneathabstraction.com/css/syntax.css>
<title>ASP.Net MVC 5 and Security - Beneath Abstraction</title>
<link rel=icon type=image/x-icon href=/images/github.png>
<meta name=theme-color content="#1e2327">
<meta name=description content="Security? Security is one of the most important cross-cutting concern for any web application. All applications (except for static web sites) require to identify a user and restrict the users from viewing or performing actions on pages.
Authentication Authentication is the method by which an application identifies a user. By identifying a user, the application can decide whether the user is a valid user to access the application.
Authorization Authorization is the way the application decides if the identified user can view a particular page or perform a particular action.">
<meta name=keywords content="blog,techical blog,Microsoft .Net,Csharp,asp.net,docker,mvc,kubernetes,pulumi">
<meta name=robots content="noodp">
<link rel=canonical href=https://www.beneathabstraction.com/post/mvc5security/>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="ASP.Net MVC 5 and Security - Beneath Abstraction">
<meta name=twitter:description content="Security? Security is one of the most important cross-cutting concern for any web application. All applications (except for static web sites) require to identify a user and restrict the users from viewing or performing actions on pages.
Authentication Authentication is the method by which an application identifies a user. By identifying a user, the application can decide whether the user is a valid user to access the application.
Authorization Authorization is the way the application decides if the identified user can view a particular page or perform a particular action.">
<meta name=twitter:site content="https://www.beneathabstraction.com/">
<meta name=twitter:creator content>
<meta name=twitter:image content="https://www.beneathabstraction.com/">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.Net MVC 5 and Security - Beneath Abstraction">
<meta property="og:description" content="Security? Security is one of the most important cross-cutting concern for any web application. All applications (except for static web sites) require to identify a user and restrict the users from viewing or performing actions on pages.
Authentication Authentication is the method by which an application identifies a user. By identifying a user, the application can decide whether the user is a valid user to access the application.
Authorization Authorization is the way the application decides if the identified user can view a particular page or perform a particular action.">
<meta property="og:url" content="https://www.beneathabstraction.com/post/mvc5security/">
<meta property="og:site_name" content="ASP.Net MVC 5 and Security">
<meta property="og:image" content="https://www.beneathabstraction.com/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:published_time" content="2017-10-14 10:51:44 +1100 +1100">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171421715-1"></script>
<script>if(navigator.doNotTrack!=='1'){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-171421715-1')}</script>
</head>
<body>
<div style=position:relative>
<header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
<div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px>
<a class=Header-link href=https://www.beneathabstraction.com/><svg class="octicon" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
</a>
</div>
<div class="Header-item d-md-none">
<button class="Header-link btn-link js-details-target" type=button onclick="document.querySelector('#header-search').style.display=document.querySelector('#header-search').style.display=='none'?'block':'none'"><svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg>
</button>
</div>
<div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
<div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
<div class=position-relative>
<form target=_blank action=https://www.google.com/search accept-charset=utf-8 method=get autocomplete=off>
<label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
<input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off>
<input type=hidden name=q value=site:https://www.beneathabstraction.com/>
</label>
</form>
</div>
</div>
</div>
<div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
<a class=Header-link href=https://www.beneathabstraction.com/><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
</a>
</div>
<div class=Header-item style=margin-right:0>
<a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg>
</a>
</div>
</header>
</div>
<div>
<main>
<div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
<div class=px-0>
<div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
<div class="flex-auto min-width-0 width-fit mr-3">
<div class=d-flex>
<div class="d-none d-md-block">
<a class="avatar mr-2 flex-shrink-0" href=https://www.beneathabstraction.com/>
<img class=avatar-user src="https://avatars.githubusercontent.com/u/1662197?s=400&u=d1fd525c38f21c760b5f73d3046d9cdee3debcc3&v=4" width=32 height=32></a>
</div>
<div class="d-flex flex-column">
<h1 class="break-word f3 text-normal mb-md-0 mb-1">
<span class=author>
<a href=https://www.beneathabstraction.com/>Gopakumar</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://www.beneathabstraction.com/post/mvc5security/>ASP.Net MVC 5 and Security</a></strong>
</h1>
<div class="note m-0">
Created <relative-time datetime="Sat, 14 Oct 2017 10:51:44 +1100" class=no-wrap>
Sat, 14 Oct 2017 10:51:44 +1100</relative-time>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="container-lg px-3 new-discussion-timeline">
<div class="repository-content gist-content">
<div>
<div class="js-gist-file-update-container js-task-list-container file-box">
<div id=file-pytest class="file my-2">
<div class="file-header d-flex flex-md-items-center flex-items-start">
<div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
<div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
645 Words
</div>
<div class="file-actions flex-order-2 pt-0">
<a class="muted-link mr-3" href=/tags/asp.net><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
ASP.Net
</a>
<a class="muted-link mr-3" href=/tags/security><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
Security
</a>
<a class="muted-link mr-3" href=/tags/.net><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
.Net
</a>
<a class="muted-link mr-3" href=/tags/c><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
c#
</a>
<a class="muted-link mr-3" href=/tags/mvc><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
MVC
</a>
</div>
</div>
</div>
<div class="Box-body px-5 pb-5">
<article class="markdown-body entry-content container-lg"><h2 id=security>Security?</h2>
<p>Security is one of the most important cross-cutting concern for any web application. All applications (except for static web sites) require to identify a user and restrict the users from viewing or performing actions on pages.</p>
<h2 id=authentication>Authentication</h2>
<p>Authentication is the method by which an application identifies a user. By identifying a user, the application can decide whether the user is a valid user to access the application.</p>
<h2 id=authorization>Authorization</h2>
<p>Authorization is the way the application decides if the identified user can view a particular page or perform a particular action.</p>
<p>ASP.Net MVC 5 has introduced ASP.Net Identity which supports implementing security concerns in MVC applications. I will start with an empty ASP.Net MVC Project and then try to add security step by step.</p>
<h2 id=a-bit-of-history>A bit of history</h2>
<p>Microsoft introduced Membership Provide with ASP.Net 2.0 back in the days to handle all security-related concerns. ASP.Net Membership provider supported Forms Authentication with SQL Server database which stored user names, password, and other user data.</p>
<p>Membership provider supported database schema which uses SQL Server. Any additional profile data is stored in separate tables and accessed using the Profile provider API. The membership provider providers interfaces to write customer providers to handle data storage differently.</p>
<p>While Membership provider was service the purpose during its time, modern web applications got different ways to handle membership, authentication, and authorization.</p>
<h2 id=the-fresh-look>The fresh look</h2>
<p>Modern applications have a different approach to security with multiple ways of handling authentication and authorizations. Membership systems now have to support web, mobile and restful API applications, also social logins and cloud-based authentication platforms.</p>
<p>Microsoft introduced ASP.Net Identity as part of the MVC framework to cater to all the requirements of the modern day applications whether it is web, mobile, store or hybrid applications.</p>
<p>Introduction of ASPNet Identity brings in role providers, social logins, claim based and is based on OWIN specification, which makes it a component that can be hosted in any OWIN based hosting providers and it is independent of System.Web library. ASPNet identity is distributed via Nuget and hence it gets introduced only in a project that requires it.</p>
<h2 id=now-to-get-into-the-details>Now to get into the details</h2>
<p><strong>Dependencies</strong></p>
<p>To introduce ASPNet Identity to any ASP.Net project, you need to install the below NuGet packages.</p>
<ul>
<li>
<p>Microsoft.AspNet.Identity.Core</p>
<p>Core package of the identity that can be used to write implementations to target user data storage to different persistence types like a NoSQL database.</p>
</li>
<li>
<p>Microsoft.AspNet.Identity.OWIN</p>
<p>The package that introduces OWIN middleware supporting identity like login/logout, cookie creation, etc.</p>
</li>
<li>
<p>Microsoft.AspNet.Identity.EntityFramework</p>
<p>The package that introduces EF implementation of ASPNet Identity to persist the identity data into SQL Server.</p>
</li>
</ul>
<p><strong>User registration, Login/out</strong></p>
<p>Once the packages are introduced, the UserStore and PasswordStore interfaces can be implemented to alter storage. Using the UserManager, SignInManager and AuthenticationManager classed provided, user registration and login/logout can be handled.</p>
<p>A startup class needs to be created and decorated with OwinStartup assembly attribute and cookie authentication middleware from OWIN can be added to app builder to enable cookie creation. The startup class &ldquo;configure&rdquo; method can be used to configure other middlewares like the social login middleware.</p>
<p><strong>Roles, Claims, and Identity in request context</strong></p>
<p>The OWIN middleware give options to use the default middleware to generate identity or override the existing providers to add functionality to the identity of the user in the request context.
The default CookieAuthenticationProvider can be overridden to add custom logic to add claims or roles to the Identity user instance and inject claims identity into context.</p>
<p>This injected user identity instance can be accessed across the layers and required authorization logic can be added either through custom ClaimsAuthorize authorization filter or by accessing the ClaimsIdentity instance directly from the HttpContext principle and checking the presence of a particular claim.</p>
<p>There are many references available that details the way ASPNet identity is implemented below are a few links.</p>
<ul>
<li><a href=https://docs.microsoft.com/en-us/aspnet/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project>Introduce ASPNet Identity to existing projects.</a></li>
<li><a href=https://www.codeguru.com/csharp/.net/net_security/asp.net-mvc-and-claim-based-security.html>Claim based security MVC</a></li>
</ul>
</article>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
</div>
<div class="footer container-xl width-full p-responsive">
<div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light">
<a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://www.beneathabstraction.com/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
</a>
<ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
<li class="mr-3 mr-lg-0">Theme by <a href=https://github.com/MeiK2333/github-style>github-style</a></li>
</ul>
</div>
<div class="d-flex flex-justify-center pb-6">
<span class="f6 text-gray-light"></span>
</div>
</div>
</body>
<script type=application/javascript src=https://www.beneathabstraction.com/js/github-style.js></script>
</html>