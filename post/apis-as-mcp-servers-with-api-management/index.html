<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches | Beneath Abstraction</title><meta name=keywords content="AI,MCP,Model Context Protocol,Azure API Management,AI Gateway"><meta name=description content="Introduction
The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.
In this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:"><meta name=author content="Me"><link rel=canonical href=https://www.beneathabstraction.com/post/apis-as-mcp-servers-with-api-management/><meta name=google-site-verification content="G-GMEVCEV281"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.beneathabstraction.com/images/logo.png><link rel=icon type=image/png sizes=16x16 href=https://www.beneathabstraction.com/images/logo.png><link rel=icon type=image/png sizes=32x32 href=https://www.beneathabstraction.com/images/logo.png><link rel=apple-touch-icon href=https://www.beneathabstraction.com/images/logo.png><link rel=mask-icon href=https://www.beneathabstraction.com/images/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.beneathabstraction.com/post/apis-as-mcp-servers-with-api-management/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","oo3areu9yf")</script><meta property="og:title" content="Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches"><meta property="og:description" content="Introduction
The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.
In this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.beneathabstraction.com/post/apis-as-mcp-servers-with-api-management/"><meta property="og:image" content="https://www.beneathabstraction.com/images/logo.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-07-20T19:00:50+10:00"><meta property="article:modified_time" content="2025-07-20T19:00:50+10:00"><meta property="og:site_name" content="Beneath Abstraction"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.beneathabstraction.com/images/logo.png"><meta name=twitter:title content="Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches"><meta name=twitter:description content="Introduction
The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.
In this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.beneathabstraction.com/post/"},{"@type":"ListItem","position":2,"name":"Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches","item":"https://www.beneathabstraction.com/post/apis-as-mcp-servers-with-api-management/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches","name":"Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches","description":"Introduction The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.\nIn this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:\n","keywords":["AI","MCP","Model Context Protocol","Azure API Management","AI Gateway"],"articleBody":"Introduction The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.\nIn this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:\nCustom MCP Server Application: Building a dedicated MCP server application and exposing it through API Management API Management MCP Server (preview): Leveraging Azure API Management’s preview feature for out of the box MCP server creation Both approaches can leverage Azure API Management’s policy engine to implement security, rate limiting, and other enterprise requirements.\nApproach 1: Custom MCP Server Application with Azure API Management The first approach involves creating a custom MCP server application and then exposing it through Azure API Management. This method provides maximum flexibility and control over the MCP implementation.\nBuilding the Custom MCP Server Create an MCP server using any supported language and essentially create “tool” wrapping the API functionality. Below is a sample i created using dotnet and the ModelContextProtocol library\nTool [McpServerToolType] public class WeatherPredictionTool(WeatherService weatherService) { //Wraps the logic to call the Weather REST API. private readonly WeatherService _weatherService = weatherService; [McpServerTool, Description(\"Calls the Weather Prediction API and returns a weather forecast for a given city.\")] public string ForecastWeather(string city) { return _weatherService.ForecastWeather(city) .ContinueWith(task =\u003e { if (task.IsFaulted) { return $\"Error fetching weather data: {task.Exception?.Message}\"; } var forecasts = task.Result; return string.Join(\"\\n\", forecasts.Select(f =\u003e $\"{f.Date}: {f.TemperatureC}°C, {f.Summary}\")); }).Result; } } program.cs builder.Services .AddMcpServer() .WithTools\u003cWeatherPredictionTool\u003e() .WithHttpTransport(); var app = builder.Build(); app.MapMcp(\"mcp\"); await app.RunAsync(); Deploying to Azure API Management Once your custom MCP server is built and deployed to a suitable hosting service (App Service or Container Apps) you’ll need to configure endpoints in Azure API Management:\nDeploy API: Deploy an API with the backend as the MCP server exposing POST /message and GET /sse operations. Use bicep to deploy the API and Operations Sample bicep resource mcpApi 'Microsoft.ApiManagement/service/apis@2023-05-01-preview' = { parent: apimService name: 'mcp' properties: { ... path: 'mcp' protocols: [ 'https' ] serviceUrl: mcpServerServiceUrl } } resource mcpApiPolicy 'Microsoft.ApiManagement/service/apis/policies@2023-05-01-preview' = { parent: mcpApi name: 'policy' properties: { format: 'rawxml' value: loadTextContent('mcp-policy.xml') } } resource mcpSseOperation 'Microsoft.ApiManagement/service/apis/operations@2023-05-01-preview' = { parent: mcpApi name: 'mcp-sse' properties: { displayName: 'MCP SSE Endpoint' method: 'GET' urlTemplate: '/sse' ... } } resource mcpMessageOperation 'Microsoft.ApiManagement/service/apis/operations@2023-05-01-preview' = { parent: mcpApi name: 'mcp-message' properties: { displayName: 'MCP Message Endpoint' method: 'POST' urlTemplate: '/message' ... } } Apply Policies: Implement security and transformation policies. Sample API Management Policy with just rate limiting, this could be any supported policy. ","wordCount":"841","inLanguage":"en","image":"https://www.beneathabstraction.com/images/logo.png","datePublished":"2025-07-20T19:00:50+10:00","dateModified":"2025-07-20T19:00:50+10:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.beneathabstraction.com/post/apis-as-mcp-servers-with-api-management/"},"publisher":{"@type":"Organization","name":"Beneath Abstraction","logo":{"@type":"ImageObject","url":"https://www.beneathabstraction.com/images/logo.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.beneathabstraction.com/ accesskey=h title="_ (Alt + H)"><img src=https://www.beneathabstraction.com/images/logo.png alt aria-label=logo height=35>_</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.beneathabstraction.com/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.beneathabstraction.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://www.beneathabstraction.com/archives title=archive><span>archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.beneathabstraction.com/>Home</a>&nbsp;»&nbsp;<a href=https://www.beneathabstraction.com/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches</h1><div class=post-meta><span title='2025-07-20 19:00:50 +1000 +1000'>July 20, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;841 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/gopkumr/gopkumr.github.io/tree/main/content/post/restapi-mcp-apim.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#approach-1-custom-mcp-server-application-with-azure-api-management>Approach 1: Custom MCP Server Application with Azure API Management</a><ul><li><a href=#building-the-custom-mcp-server>Building the Custom MCP Server</a></li><li><a href=#tool>Tool</a></li><li><a href=#programcs>program.cs</a></li><li><a href=#deploying-to-azure-api-management>Deploying to Azure API Management</a></li><li><a href=#sample-bicep>Sample bicep</a></li><li><a href=#sample-api-management-policy-with-just-rate-limiting-this-could-be-any-supported-policy>Sample API Management Policy with just rate limiting, this could be any supported policy.</a></li></ul></li><li><a href=#approach-2-one-click-mcp-server-preview-feature>Approach 2: One-Click MCP Server (Preview Feature)</a><ul><li><a href=#enabling-the-preview-feature>Enabling the Preview Feature</a></li><li><a href=#configuring-one-click-mcp-server>Configuring One-Click MCP Server</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>The Model Context Protocol (MCP) has changed the way how AI applications interact with external data sources and services, and the need to securely expose REST APIs as MCP servers has become more critical. Azure API Management provides an enterprise-grade solution that facilitates this transformation and along with its robust security, monitoring, and governance capabilities.</p><p>In this post, I explore two approaches to expose REST APIs as MCP servers using Azure API Management:</p><ol><li><strong>Custom MCP Server Application</strong>: Building a dedicated MCP server application and exposing it through API Management</li><li><strong>API Management MCP Server (preview)</strong>: Leveraging Azure API Management&rsquo;s preview feature for out of the box MCP server creation</li></ol><p>Both approaches can leverage Azure API Management&rsquo;s policy engine to implement security, rate limiting, and other enterprise requirements.</p><h2 id=approach-1-custom-mcp-server-application-with-azure-api-management>Approach 1: Custom MCP Server Application with Azure API Management<a hidden class=anchor aria-hidden=true href=#approach-1-custom-mcp-server-application-with-azure-api-management>#</a></h2><p>The first approach involves creating a custom MCP server application and then exposing it through Azure API Management. This method provides maximum flexibility and control over the MCP implementation.</p><h3 id=building-the-custom-mcp-server>Building the Custom MCP Server<a hidden class=anchor aria-hidden=true href=#building-the-custom-mcp-server>#</a></h3><p>Create an MCP server using any supported language and essentially create &ldquo;tool&rdquo; wrapping the API functionality. Below is a sample i created using dotnet and the ModelContextProtocol library</p><h3 id=tool>Tool<a hidden class=anchor aria-hidden=true href=#tool>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[McpServerToolType]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>WeatherPredictionTool</span><span class=p>(</span><span class=n>WeatherService</span> <span class=n>weatherService</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Wraps the logic to call the Weather REST API.</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>WeatherService</span> <span class=n>_weatherService</span> <span class=p>=</span> <span class=n>weatherService</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [McpServerTool, Description(&#34;Calls the Weather Prediction API and returns a weather forecast for a given city.&#34;)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>ForecastWeather</span><span class=p>(</span><span class=kt>string</span> <span class=n>city</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>_weatherService</span><span class=p>.</span><span class=n>ForecastWeather</span><span class=p>(</span><span class=n>city</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=p>.</span><span class=n>ContinueWith</span><span class=p>(</span><span class=n>task</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>             <span class=p>{</span>
</span></span><span class=line><span class=cl>                 <span class=k>if</span> <span class=p>(</span><span class=n>task</span><span class=p>.</span><span class=n>IsFaulted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=k>return</span> <span class=s>$&#34;Error fetching weather data: {task.Exception?.Message}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>                 <span class=kt>var</span> <span class=n>forecasts</span> <span class=p>=</span> <span class=n>task</span><span class=p>.</span><span class=n>Result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                 <span class=k>return</span> <span class=kt>string</span><span class=p>.</span><span class=n>Join</span><span class=p>(</span><span class=s>&#34;\n&#34;</span><span class=p>,</span> <span class=n>forecasts</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>f</span> <span class=p>=&gt;</span> <span class=s>$&#34;{f.Date}: {f.TemperatureC}°C, {f.Summary}&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>             <span class=p>}).</span><span class=n>Result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=programcs>program.cs<a hidden class=anchor aria-hidden=true href=#programcs>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Services</span>
</span></span><span class=line><span class=cl>     <span class=p>.</span><span class=n>AddMcpServer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>     <span class=p>.</span><span class=n>WithTools</span><span class=p>&lt;</span><span class=n>WeatherPredictionTool</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>     <span class=p>.</span><span class=n>WithHttpTransport</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>app</span> <span class=p>=</span> <span class=n>builder</span><span class=p>.</span><span class=n>Build</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>MapMcp</span><span class=p>(</span><span class=s>&#34;mcp&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>app</span><span class=p>.</span><span class=n>RunAsync</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=deploying-to-azure-api-management>Deploying to Azure API Management<a hidden class=anchor aria-hidden=true href=#deploying-to-azure-api-management>#</a></h3><p>Once your custom MCP server is built and deployed to a suitable hosting service (App Service or Container Apps) you&rsquo;ll need to configure endpoints in Azure API Management:</p><ol><li><strong>Deploy API</strong>: Deploy an API with the backend as the MCP server exposing POST /message and GET /sse operations. Use bicep to deploy the API and Operations</li></ol><h3 id=sample-bicep>Sample bicep<a hidden class=anchor aria-hidden=true href=#sample-bicep>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>mcpApi</span><span class=w> </span><span class=s>&#39;Microsoft.ApiManagement/service/apis@2023-05-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>apimService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mcp&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>path</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mcp&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>protocols</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=s>&#39;https&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>serviceUrl</span><span class=p>:</span><span class=w> </span><span class=nv>mcpServerServiceUrl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>mcpApiPolicy</span><span class=w> </span><span class=s>&#39;Microsoft.ApiManagement/service/apis/policies@2023-05-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>mcpApi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;policy&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>format</span><span class=p>:</span><span class=w> </span><span class=s>&#39;rawxml&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>value</span><span class=p>:</span><span class=w> </span><span class=nf>loadTextContent</span><span class=p>(</span><span class=s>&#39;mcp-policy.xml&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>mcpSseOperation</span><span class=w> </span><span class=s>&#39;Microsoft.ApiManagement/service/apis/operations@2023-05-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>mcpApi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mcp-sse&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;MCP SSE Endpoint&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>method</span><span class=p>:</span><span class=w> </span><span class=s>&#39;GET&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>urlTemplate</span><span class=p>:</span><span class=w> </span><span class=s>&#39;/sse&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>mcpMessageOperation</span><span class=w> </span><span class=s>&#39;Microsoft.ApiManagement/service/apis/operations@2023-05-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>mcpApi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mcp-message&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;MCP Message Endpoint&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>method</span><span class=p>:</span><span class=w> </span><span class=s>&#39;POST&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>urlTemplate</span><span class=p>:</span><span class=w> </span><span class=s>&#39;/message&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li><strong>Apply Policies</strong>: Implement security and transformation policies.</li></ol><h3 id=sample-api-management-policy-with-just-rate-limiting-this-could-be-any-supported-policy>Sample API Management Policy with just rate limiting, this could be any supported policy.<a hidden class=anchor aria-hidden=true href=#sample-api-management-policy-with-just-rate-limiting-this-could-be-any-supported-policy>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;policies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;inbound&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;base</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Rate Limiting --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;rate-limit-by-key</span> <span class=na>calls=</span><span class=s>&#34;100&#34;</span> <span class=na>renewal-period=</span><span class=s>&#34;60&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/inbound&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;backend&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;base</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/backend&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;outbound&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;base</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/outbound&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;on-error&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;base</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/on-error&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/policies&gt;</span>
</span></span></code></pre></div><h2 id=approach-2-one-click-mcp-server-preview-feature>Approach 2: One-Click MCP Server (Preview Feature)<a hidden class=anchor aria-hidden=true href=#approach-2-one-click-mcp-server-preview-feature>#</a></h2><p>Azure API Management&rsquo;s one-click MCP server feature (currently in preview) allows you to instantly convert existing REST APIs into MCP-compatible servers without writing custom code.
<code>Please note: Since this feature is preview while writing this post, the feature and functionality may change when it gets general availability.</code></p><h3 id=enabling-the-preview-feature>Enabling the Preview Feature<a hidden class=anchor aria-hidden=true href=#enabling-the-preview-feature>#</a></h3><p>To use the one-click MCP server feature:</p><ol><li>Follow these only if you are on classic skus (non v2)<ul><li>Go to the “Deployment + Infrastructure” section and open “Service Updates” page</li><li>Edit Update Group and enable “AI Gateway Early”, wait for around couple of hours or so to receive the update</li></ul></li><li>Navigate to the portal using <a href="https://portal.azure.com/?Microsoft_Azure_ApiManagement=mcp">https://portal.azure.com/?Microsoft_Azure_ApiManagement=mcp</a></li><li>Navigate to your Azure API Management instance</li></ol><h3 id=configuring-one-click-mcp-server>Configuring One-Click MCP Server<a hidden class=anchor aria-hidden=true href=#configuring-one-click-mcp-server>#</a></h3><h4 id=prerequisite>Prerequisite<a hidden class=anchor aria-hidden=true href=#prerequisite>#</a></h4><p>Import the REST API into API Management using OpenAPI spec or deploying API, Operations separately.</p><h4 id=deploying-mcp-server>Deploying MCP Server<a hidden class=anchor aria-hidden=true href=#deploying-mcp-server>#</a></h4><ol><li>Navigate to API Management (make sure you are using the URL that has this query string &ldquo;Microsoft_Azure_ApiManagement=mcp&rdquo;)</li><li>Open APIs section and open the MCP Servers page
<img loading=lazy src=/blogimages/apim-mcp-1.png alt="MCP Server Page"></li><li>Click on the Create MCP Server page and select the imported API and all the operations that you want to expose as tools
<img loading=lazy src=/blogimages/apim-mcp-2.png alt="MCP Server create"></li><li>Hit Create and you have the MCP server available with an /sse endpoint ready to use</li><li>Clicking on the MCP Server name, directs you to a page where you can configure policies for the MCP server</li></ol><p>Regardless of which approach you choose, you can implement APIMs robust security, monitoring and caching capabilities .</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Azure API Management provides powerful capabilities for exposing REST APIs as MCP servers through two distinct approaches.</p><p>The custom MCP server application provides maximum flexibility and control, making it perfect for complex scenarios with specific needs—especially when the backend data source go beyond just REST API or involve aggregating multiple REST APIs</p><p>The one-click MCP server feature provides a rapid path to MCP adoption with minimal development effort where a REST API already available in API Management and MCP client is a consumer.
Whether you’re just starting with MCP or looking to scale existing implementations, Azure API Management provides the tools and flexibility needed in AI-driven landscape.</p><p>All samples used in this post is available in my github repo: <a href=https://github.com/gopkumr/restapi-mcp-apim>https://github.com/gopkumr/restapi-mcp-apim</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.beneathabstraction.com/tags/ai/>AI</a></li><li><a href=https://www.beneathabstraction.com/tags/mcp/>MCP</a></li><li><a href=https://www.beneathabstraction.com/tags/model-context-protocol/>Model Context Protocol</a></li><li><a href=https://www.beneathabstraction.com/tags/azure-api-management/>Azure API Management</a></li><li><a href=https://www.beneathabstraction.com/tags/ai-gateway/>AI Gateway</a></li></ul><nav class=paginav><a class=prev href=https://www.beneathabstraction.com/post/csharp14-field-backed-properties/><span class=title>« Prev</span><br><span>C# 14 Field-Backed Properties: A Cleaner Way</span>
</a><a class=next href=https://www.beneathabstraction.com/post/expose-ai-endpoints-via-api-management/><span class=title>Next »</span><br><span>Exposing Azure AI Foundry Endpoints with Azure API Management</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on x" href="https://x.com/intent/tweet/?text=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches&amp;url=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f&amp;hashtags=AI%2cMCP%2cModelContextProtocol%2cAzureAPIManagement%2cAIGateway"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f&amp;title=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches&amp;summary=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches&amp;source=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f&title=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on whatsapp" href="https://api.whatsapp.com/send?text=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches%20-%20https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on telegram" href="https://telegram.me/share/url?text=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches&amp;url=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Exposing REST APIs as MCP Servers with Azure API Management: 2 Approaches on ycombinator" href="https://news.ycombinator.com/submitlink?t=Exposing%20REST%20APIs%20as%20MCP%20Servers%20with%20Azure%20API%20Management%3a%202%20Approaches&u=https%3a%2f%2fwww.beneathabstraction.com%2fpost%2fapis-as-mcp-servers-with-api-management%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=gopkumr/gopkumr.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNDU1NjQ0NTM=" data-category=General data-category-id=DIC_kwDOFJjlJc4Cgwlh data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.beneathabstraction.com/>Beneath Abstraction</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>